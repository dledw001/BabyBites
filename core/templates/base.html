<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}BabyBites{% endblock %}</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Grandstander:wght@700;800&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- BabyBites CSS -->
    {% load static %}
    <link href="{% static 'core/css/custom.css' %}" rel="stylesheet">

    <!-- PWA Manifest -->
    <link rel="manifest" href="{% static 'manifest.webmanifest' %}">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="{% static 'core/img/apple-touch-icon.png' %}">
    <link rel="icon" href="{% static 'core/img/favicon.ico' %}">
</head>

<body class="babybites-body">

<!-- LEFT NAVBAR (Desktop) -->
{% if request.resolver_match and request.resolver_match.url_name != 'home' and request.resolver_match.url_name != 'dashboard' %}
<nav class="bb-left-nav d-none d-md-flex flex-column position-fixed top-0 start-0 vh-100 p-3"
     style="background-color: #f5a5c5; border-right: 2px solid #e48ab0;">
    <div class="bb-logo-tile mb-3 d-flex align-items-center justify-content-center">
        <img src="{% static 'core/img/babybites-logo.png' %}" alt="BabyBites logo" class="bb-logo-img">
    </div>

    <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
            {% if user.is_authenticated and profiles %}
            <div class="mb-3">
                <label class="text-white-50 mb-1 small center-text">Active Profile</label>
                <div class="dropdown">
                    <button class="btn btn-light w-100 dropdown-toggle text-start" type="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                        {% if active_profile %}
                            {{ active_profile.name }}
                        {% else %}
                            Select profile
                        {% endif %}
                    </button>
                    <ul class="dropdown-menu w-100">
                        {% for p in profiles %}
                        <li>
                            <form method="post" action="{% url 'set-active-profile' p.id %}">
                                {% csrf_token %}
                                <button class="dropdown-item {% if active_profile and active_profile.id == p.id %}active{% endif %}"
                                        type="submit">
                                    {{ p.name }}
                                    {% if p.date_of_birth %}
                                        <span class="text-muted"> â€” {{ p.date_of_birth|date:"m/d/Y" }}</span>
                                    {% endif %}
                                </button>
                            </form>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </li>

        <li><a href="{% url 'dashboard' %}" class="nav-link {% if request.path == '/dashboard/' %}active{% endif %}">
            <i class="bi bi-house-door me-2"></i> DASHBOARD</a></li>
        <li><a href="{% url 'tracker' %}" class="nav-link {% if 'tracker' in request.path %}active{% endif %}">
            <i class="bi bi-journal-text me-2"></i> FOOD TRACKER</a></li>
        <li><a href="{% url 'food_list' %}" class="nav-link {% if 'food_list' in request.path %}active{% endif %}">
            <i class="bi bi-database me-2"></i> FOOD DATABASE</a></li>
        <li><a href="{% url 'catalog' %}" class="nav-link {% if 'catalog' in request.path %}active{% endif %}">
            <i class="bi bi-grid me-2"></i> BabyBites CATALOG</a></li>
        <li><a href="{% url 'report_preview' %}" class="nav-link {% if 'report/preview' in request.path %}active{% endif %}">
            <i class="bi bi-graph-up me-2"></i> DAILY REPORTS</a></li>
        <li><a href="{% url 'resources' %}" class="nav-link {% if 'resources' in request.path %}active{% endif %}">
            <i class="bi bi-book me-2"></i> RESOURCES</a></li>
    </ul>

    {% if user.is_authenticated %}
    <form method="post" action="{% url 'logout' %}" class="p-2 border rounded bg-white shadow-sm">
        {% csrf_token %}
        <button type="submit" class="btn btn-outline-dark w-100">LOG OUT</button>
    </form>
    {% endif %}
</nav>
{% endif %}

<!-- BOTTOM NAVBAR (Mobile) -->
{% if request.resolver_match and request.resolver_match.url_name != 'home' and request.resolver_match.url_name != 'dashboard' %}
<nav class="bb-bottom-nav d-md-none fixed-bottom">
    <div class="bb-nav-container">
        <a href="{% url 'dashboard' %}" class="bb-nav-item">DASHBOARD</a>
        <a href="{% url 'tracker' %}" class="bb-nav-item">FOOD TRACKER</a>
        <a href="{% url 'food_list' %}" class="bb-nav-item">FOOD DATABASE</a>
        <a href="{% url 'catalog' %}" class="bb-nav-item">BabyBites CATALOG</a>
        <a href="{% url 'report_preview' %}" class="bb-nav-item">DAILY REPORTS</a>
        <a href="{% url 'resources' %}" class="bb-nav-item">RESOURCES</a>

        <!-- logout circle -->
      <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="bb-nav-item logout border-0">LOG OUT</button>
      </form>

    </div>
</nav>
{% endif %}

<!-- MAIN CONTENT -->
<main class="container my-4">
  {% block content %}{% endblock %}
</main>

<footer class="text-center mt-3 mb-0">
  <p class="text-center mt-3 mb-0">
    Check out the project on <a href="https://github.com/dledw001/BabyBites">GitHub</a>!
  </p>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
